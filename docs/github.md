# Project Organization

## Table of Contents

> - [Folder Structure][1]
> - [`tsconfig.json` and Compilation][2]

## Folder Structure

`bin/` contains the code for the CLI. Rather than keeping a copy of the
entire project, it simply uses `yargs` to provide an interface and `require`s
the main project.

`dist/` contains the compiled build output, and consists solely of
autogenerated files.

`docs/` contains user documentation, entirely in MarkDown.

`src/` contains the code for the main project. Everything exposed by the API is
in there; directly user-facing code is in `src/index.ts`.

`tests/` contains all test cases, and is currently a bit lacking. Any
suggestions or contributions here are appreciated!

## `tsconfig.json` and Compilation

Originally, this project had each file compiled separately, and they were
pasted together and minified by hand. Later, I attempted to use TypeScript's
built-in `--outFile` option, but [the output it produced][3] wouldn't run; all
imports resolved to empty object. Eventually, I decided to instead use a shell
script. The first version of this was a seven-line bash program (with a zsh
counterpart):

```bash
echo 'Combining files...'
cat src/*.ts > combined.ts
sed -i '/export/d' combined.ts
sed -i '/import/d' combined.ts
echo 'Compiling to JS...'
tsc
echo 'Done.'
```

This script has grown and changed to handle linting, minification, and now even
tests, and works on any POSIX-compliant shell. It now lives at
[`/build.sh`][4], and is used as the `prepack` script. It's the reason why this
project is considered, at the time of writing, to be roughly 6% shell script.

> Note: The combination of files is used so that the web app is a single
> `.min.js` file. The way the build script handles `import` and `export`
> statements is rather limiting, so any PRs that get the one-file output to
> work using a more well-established tool (such as `--outFile`) would be
> greatly appreciated. However, I am not going to put any further effort into
> the problem.
> 
> The CLI does not use this process. NodeJS can handle `require()` statements,
> but a browser can't.

One artifact of this build process is that the top-level `tsconfig.json`
doesn't apply to the files in `src/`, so code hints would be inaccurate, and
unexpected errors would come up when compiling. To aid the IDE and remedy this
problem, I added `src/tsconfig.json`, which has the same compiler options (save
for those the IDE doesn't care about, such as `--outDir`) but includes all
TypeScript files in `src/`.

Finally, there is a third `tsconfig.json` file, in `bin/`. This is present out
of necessity, as `bin/` is compiled separately from `src/`.

<!-- MarkDown, why don't you have anything I can do about long URLs? -->
[1]: #folder-structure
[2]: #tsconfigjson-and-compilation
[3]: https://github.com/bbrk24/lexifer-ts/blob/66059471e847beee111863df0f9a27367fd5155f/dist/index.js
[4]: ../build.sh
